{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">

<div class="admin-header">
  <h2>Category 1 Listings</h2>
  <nav class="admin-tabs">
    <a href="{{ url_for('admin.dashboard') }}">Overview</a>
    <a href="{{ url_for('admin.category1_listings') }}" class="active">Category 1</a>
    <a href="{{ url_for('admin.category2_listings') }}">Category 2</a>
    <a href="{{ url_for('admin.category3_products') }}">Category 3</a>
    <a href="{{ url_for('admin.users') }}">Users</a>
    <a href="{{ url_for('admin.analytics') }}">Analytics</a>
    <a href="{{ url_for('admin.settings') }}">Settings</a>
  </nav>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="messages">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<div class="filter">
  <a href="{{ url_for('admin.category1_listings') }}" {% if status_filter == 'all' %}class="active"{% endif %}>All</a>
  <a href="{{ url_for('admin.category1_listings', status='pending') }}" {% if status_filter == 'pending' %}class="active"{% endif %}>Pending</a>
  <a href="{{ url_for('admin.category1_listings', status='approved') }}" {% if status_filter == 'approved' %}class="active"{% endif %}>Approved</a>
  <a href="{{ url_for('admin.category1_listings', status='rejected') }}" {% if status_filter == 'rejected' %}class="active"{% endif %}>Rejected</a>
  
  <a href="{{ url_for('admin.create_category1_listing') }}" class="btn-create">+ Create New</a>
</div>

<div class="panel">
  <table class="listing">
    <tr>
      <th>ID</th>
      <th>User</th>
      <th>Title</th>
      <th>Route</th>
      <th>Date</th>
      <th>Price</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
    {% for l in listings %}
    <tr>
      <td>{{ l.id }}</td>
      <td>{{ l.user.email }}</td>
      <td>{{ l.title }}</td>
      <td>{{ l.origin }} â†’ {{ l.destination }}</td>
      <td>{{ l.travel_date }}</td>
      <td>${{ "%.2f"|format(l.final_price) }}</td>
      <td><span class="badge badge-{{ l.admin_status }}">{{ l.admin_status }}</span></td>
      <td class="actions">
        <a href="{{ url_for('admin.edit_category1_listing', listing_id=l.id) }}" class="btn-edit">Edit</a>
        
        <form method="post" action="{{ url_for('admin.update_category1_status', listing_id=l.id) }}" style="display:inline">
          <select name="status" required>
            <option value="">Status</option>
            <option value="approved">Approve</option>
            <option value="rejected">Reject</option>
            <option value="pending">Pending</option>
          </select>
          <button class="btn-sm">Update</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </table>
</div>

<style>
.filter { margin-bottom: 16px; display: flex; gap: 8px; align-items: center; }
.btn-create { background: #10b981; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; margin-left: auto; }
.btn-create:hover { background: #059669; }
.badge { padding: 4px 10px; border-radius: 12px; font-size: 0.85rem; font-weight: 600; text-transform: capitalize; }
.badge-pending { background: #fef3c7; color: #92400e; }
.badge-approved { background: #d1fae5; color: #065f46; }
.badge-rejected { background: #fee2e2; color: #991b1b; }
.actions { display: flex; gap: 4px; align-items: center; }
.btn-edit { background: #3b82f6; color: white; padding: 4px 12px; border-radius: 4px; text-decoration: none; font-size: 0.85rem; }
.btn-edit:hover { background: #2563eb; }
.btn-sm { padding: 4px 8px; font-size: 0.85rem; background: #6b7280; color: white; border: none; border-radius: 4px; cursor: pointer; }
.btn-sm:hover { background: #4b5563; }
.messages { margin-bottom: 16px; }
.alert { padding: 12px; border-radius: 6px; margin-bottom: 8px; }
.alert-error { background: #fee2e2; color: #991b1b; }
.alert-success { background: #d1fae5; color: #065f46; }
</style>
{% endblock %}